#!/bin/bash

# Place in /etc/sudoers.d/systray_monitor to allow sudo:
#    thomas ALL=(ALL) NOPASSWD: /home/thomas/.bin/systray_monitor.sh

SPACES=$'\xe2\x80\x89'
DEG_CELSIUS=$'\xe2\x84\x83'

CPU_LABEL=$'\xe2\x96\xa3'
MEM_LABEL=$'\xe2\x98\xb7'
GPU_USAGE_LABEL=$'\xf0\x9f\x9e\x9b'
GPU_MEM_LABEL=$'\xf0\x9d\x8d\x91'
GPU_TEMP_LABEL=$'\xe2\x8f\xa6'
FAN_LABEL=$'\xe2\x9d\x83'

RADEONTOPRESULTS=$(radeontop -d - -l 1 | tail -n 1)

CPU_USED=$((100 - $(vmstat 1 2 | tail -1 | awk '{print $15}')))
MEMORY_USED=$(free | grep Mem | awk '{print $3/$2 * 100.0}' | awk '{print int($1+0.5)}')
GPU_TEMP=$(sensors | grep edge | cut -d ' ' -f 2- | grep -o -E '[0-9]+' | head -1)
GPU_FAN=$(sensors | grep fan1 | cut -d ' ' -f 2- | grep -o -E '[0-9]+' | head -1)
GPU_USAGE=$(echo "$RADEONTOPRESULTS" | cut -d ',' -f 2 | cut -d ' ' -f 3 | sed 's/\.[0-9][0-9]//g')
GPU_MEM=$(echo "$RADEONTOPRESULTS" | cut -d ',' -f 13 | cut -d ' ' -f 3 | sed 's/\.[0-9][0-9]//g')

OUTPUT=''

for STR in "$CPU_LABEL ${CPU_USED}%" "$MEM_LABEL ${MEMORY_USED}%" "${GPU_USAGE_LABEL} ${GPU_USAGE}" "${GPU_MEM_LABEL} ${GPU_MEM}" "$GPU_TEMP_LABEL ${GPU_TEMP}${DEG_CELSIUS}" "${FAN_LABEL} ${GPU_FAN}"; do
	OUTPUT="${OUTPUT} ${STR} ${SPACES}"
done

echo "$OUTPUT"
